@model OnlineLibrary.Web.Models.UserLoansViewModels.UserLoansViewModel

@{
    ViewBag.Title = "My Loans";
}

<h2>My Loans</h2>

<ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#status">Current Status</a></li>
    <li><a data-toggle="tab" href="#overdue">Overdue</a></li>
    <li><a data-toggle="tab" href="#expire_soon">Soon Expiring</a></li>
    <li><a data-toggle="tab" href="#non_urgent">Non-urgent</a></li>
    <li><a data-toggle="tab" href="#approved">Approved Requests</a></li>
    <li><a data-toggle="tab" href="#rejected">Rejected Requests</a></li>
    <li><a data-toggle="tab" href="#pending">Pending Requests</a></li>
    <li><a data-toggle="tab" href="#returned">Returned</a></li>
    <li><a data-toggle="tab" href="#lost">Lost</a></li>
</ul>

<div class="tab-content">
        <div id="status" class="tab-pane fade in active">
            <p></p>
            <div class="row">
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                <span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>
                                <strong>Current Status</strong>
                            </h3>
                        </div>

                        @*Displays current loan statuses*@

                        <div class="panel-body">
                            You currently have:
                            <ul>
                                <li>@Model.CurrentLoans.Count() active loans</li>
                                <li>@Model.CurrentLoans.Where(l => (l.ExpectedReturnDate.Value - DateTime.Now).Days <= 0).Count() overdue loans</li>
                                <li>@Model.CurrentLoans.Where(l => (l.ExpectedReturnDate.Value - DateTime.Now).Days <= 5 && (l.ExpectedReturnDate.Value - DateTime.Now).Days > 0).Count() soon expiring loans</li>
                                <li>@Model.CurrentLoans.Where(l => (l.ExpectedReturnDate.Value - DateTime.Now).Days > 5).Count() non-urgent active loans</li>
                                <li>@Model.ApprovedLoans.Count() approved loan requests</li>
                                <li>@Model.RejectedLoans.Count() rejected loan requests</li>
                                <li>@Model.PendingLoans.Count() pending loan requests</li>
                                <li>@Model.ReturnedLoans.Count() returned books</li>
                                <li>@Model.LostBooks.Count() lost books</li>
                            </ul>
                        </div>
                        </div>
                </div>
                <div class="col-sm-2"></div>
                <br />
            </div>
    </div>

    <div id="overdue" class="tab-pane fade">
        <p></p>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                            <strong>Loans overdue</strong>
                        </h3>
                    </div>

                    @*List loans that are overdue.*@

                    @foreach (var loan in Model.CurrentLoans)
            {
                if ((loan.ExpectedReturnDate.Value - DateTime.Now).Days <= 0)
                {
                            <div class="panel-body">
                                You have loaned <strong>"@loan.Title"</strong> and you are expected to return the book before @string.Format("{0:dddd, MMM d, yyyy}", loan.ExpectedReturnDate) - the return time is <strong>@((DateTime.Now - loan.ExpectedReturnDate.Value).Days) days overdue</strong>!
                            </div>
                        }
                    }
                </div>
            </div>
            <div class="col-sm-2"></div>
            <br />
        </div>
    </div>


    <div id="expire_soon" class="tab-pane fade">
        <p></p>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                            <strong>Loans that expire soon</strong>
                        </h3>
                    </div>

                    @*List loans that will be soon overdue.*@

                    @foreach (var loan in Model.CurrentLoans)
                    {
                        if ((loan.ExpectedReturnDate.Value - DateTime.Now).Days <= 5 && (loan.ExpectedReturnDate.Value - DateTime.Now).Days > 0)
                        {
                            <div class="panel-body">
                                You have loaned <strong>"@loan.Title"</strong> and you are expected to return the book before @string.Format("{0:dddd, MMMM dd, yyyy}", loan.ExpectedReturnDate)  - you have <strong>@((loan.ExpectedReturnDate.Value - DateTime.Now).Days) days left</strong>!
                            </div>
                        }
                    }
                </div>
            </div>
                <div class="col-sm-2"></div>
                <br />
        </div>
    </div>

    <div id="non_urgent" class="tab-pane fade">
        <p></p>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span class="glyphicon glyphicon-star-empty" aria-hidden="true"></span>
                            <strong>Non-urgent active loans</strong>
                        </h3>
                    </div>

                    @*List all current loans that are not overdue and not soon overdue.*@

                    @foreach (var loan in Model.CurrentLoans)
                    {
                        if ((loan.ExpectedReturnDate.Value - DateTime.Now).Days > 5)
                        {
                            <div class="panel-body">
                                You have loaned <strong>"@loan.Title"</strong> and you are expected to return the book before <strong>@string.Format("{0:dddd, MMMM dd, yyyy}", loan.ExpectedReturnDate)</strong>
                            </div>
                        }
                    }
                </div>
            </div>
            <div class="col-sm-2"></div>
            <br />
        </div>
    </div>

    <div id="rejected" class="tab-pane fade">
        <p></p>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                            <strong>Rejected loan requests</strong>
                        </h3>
                    </div>

                    @* Rejected loan requests.*@

                    @if (!Model.RejectedLoans.Any())
                    {
                        <div class="panel-body">
                            There are no rejected loan requests.
                        </div>
                    }
                    else
                    {
                        foreach (var loan in Model.RejectedLoans)
                        {
                            <div class="panel-body">
                                Your request for <strong> "@loan.Title" </strong> was rejected.
                            </div>
                        }
                    }
                </div>
            </div>
            <div class="col-sm-2"></div>
            <br />
        </div>
    </div>

    <div id="approved" class="tab-pane fade">
        <p></p>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>
                            <strong>Approved loan requests</strong>
                        </h3>
                    </div>

                    @* Approved loan requests.*@

                    @if (!Model.ApprovedLoans.Any())
                    {
                        <div class="panel-body">
                            There are no approved loan requests.
                        </div>
                    }
                    else
                    {
                        foreach (var loan in Model.ApprovedLoans)
                        {
                            <div class="panel-body">
                                You have sent a loan request for the book <strong>"@loan.Title"</strong> - it was approved. You are expected to go to the library and take the book.
                            </div>
                        }
                    }
                </div>
            </div>
            <div class="col-sm-2"></div>
            <br />
        </div>
    </div>

    <div id="pending" class="tab-pane fade">
        <p></p>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                            Pending loan requests
                        </h3>
                    </div>

                    @* Pending loan requests.*@

                    @if (!Model.PendingLoans.Any())
                    {
                        <div class="panel-body">
                            You have no pending loans.
                        </div>
                    }
                    else
                    {
                        foreach (var loan in Model.PendingLoans)
                        {
                            <div class="panel-body">
                                Your loan request for <strong> "@loan.BookTitle" </strong> is pending confirmation.
                            </div>
                        }
                    }
                </div>
            </div>
            <div class="col-sm-2"></div>
            <br />
        </div>
    </div>

    <div id="returned" class="tab-pane fade">
        <p></p>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span class="glyphicon glyphicon-book" aria-hidden="true"></span>
                            Returned books
                        </h3>
                    </div>

                    @* Returned books.*@

                    @if (!Model.ReturnedLoans.Any())
                    {
                        <div class="panel-body">
                            You have no returned books.
                        </div>
                    }
                    else
                    {
                        foreach (var loan in Model.ReturnedLoans)
                        {
                            <div class="panel-body">
                                You have loaned and returned the book <strong> "@loan.Title" </strong>.
                            </div>
                        }
                    }
                </div>
            </div>
            <div class="col-sm-2"></div>
            <br />
        </div>
    </div>

    <div id="lost" class="tab-pane fade">
        <p></p>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span class="glyphicon glyphicon-book" aria-hidden="true"></span>
                            Lost books
                        </h3>
                    </div>

                    @* Lost books.*@

                    @if (!Model.LostBooks.Any())
                    {
                        <div class="panel-body">
                            You have no lost books.
                        </div>
                    }
                    else
                    {
                        foreach (var loan in Model.LostBooks)
                        {
                            <div class="panel-body">
                                You have loaned and lost the book <strong> "@loan.Title" </strong>.
                            </div>
                        }
                    }
                </div>
            </div>
            <div class="col-sm-2"></div>
            <br />
        </div>
    </div>
</div>